@model Ramallah.Models.PageCategory
@using Ramallah.Models
@*
For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
<section class="ls-section">
    <div class="container pt-3" style="padding-top:150px;min-height:400px;">
        @{
            ViewData["Title"] = "Search Page";
        }
        <div class="row mb-3">
            <div class="col-12 text-right">@Html.Raw(ViewBag.Route)</div>
        </div>
        <div class="row">
            <div class="col-12 col-md-12">
                <div class="row">
                    <div class="col-12">
                        <form asp-action="Search" asp-controller="Home">
                            <div class="row">
                                <div class="col-4 col-md-3"><label for="keyword">كلمة البحث: </label><br><input
                                        type="text" value="@ViewBag.keyword" class="form-control" name="keyword"
                                        id="keyword" />
                                </div>
                                <div class="col-4 col-md-3"><label for="keyword">التصنيف </label><br>
                                    @if (ViewBag.categories != null)
                                    {
                                        <select name="category" id="category" class="form-control">
                                            <option value="">:: حدد التصنيف ::</option>
                                            @foreach (Category item in ViewBag.Categories)
                                            {
                                                var selected = "";
                                                if (ViewBag.category == item.Id)
                                                {
                                                    <option value="@item.Id" SELECTED>@item.ArName</option>
                                                }
                                                else
                                                {
                                                    <option value="@item.Id">@item.ArName</option>
                                                }
                                            }
                                        </select>
                                    }
                                </div>
                                <div class="col-4 col-md-2"><label for="keyword">من تاريخ: </label><br><input
                                        type="date"
                                        value="@(ViewBag.fromdate !=null ? ViewBag.fromdate.ToString("yyyy-MM-dd") : "")"
                                        class="form-control" name="fromdate" id="fromdate" /></div>
                                <div class="col-4 col-md-2"><label for="keyword">الى تاريخ: </label><br><input
                                        type="date"
                                        value="@(ViewBag.todate !=null ? ViewBag.todate.ToString("yyyy-MM-dd") : "")"
                                        class="form-control" name="todate" id="todate" /></div>
                                <div class="col-2 col-md-2"><br /><button type="submit"
                                        class="btn btn-primary">بحث</button></div>
                            </div>
                        </form>
                    </div>
                </div>


                <div class="row page_content mt-3" style="min-height:300px;">
                    <div class="col-12 col-md-12">
                        <div class="row">
                            <div class="col-12 mb-3">
                                <h3 class="navh6">نتائج البحث:</h3>
                            </div>
                            @if (ViewBag.pagelist != null)
                            {
                                foreach (PageCategory item in ViewBag.pagelist)
                                {
                                    <div class="col-12 col-sm-12 col-md-12 row-box text-right mb-3">
                                        <h3>
                                            @if (item.Page.Url != null && item.Page.Url!="")
                                            {
                                                <a class='btitle1' href="@Url.Content(item.Page.Url.ToString())">--
                                                    @item.Page.Title</a>
                                            }
                                            else
                                            {
                                                <a class='btitle1' href="@Url.Action("Details","Pages",new{id=item.Page.PageId,title=item.Page.Title})" > --
                                                    @item.Page.Title</a>
                                            }
                                            @if (item.Page.ShowDate)
                                            {
                                                <span class="sdate float-end mt-3">@item.Page.PageDate.ToString("yyyy-MM-dd")</span>
                                            }
                                        </h3>
                                    </div>
                                }
                            }
                            else if (ViewBag.Message != null)
                            {
                                <div class="col-12 text-center alert alert-danger mt-3">@ViewBag.Message</div>
                            }
                        </div>
                    </div>

                </div>
            </div>
            @{
                if (ViewBag.PagesCount != null && ViewBag.PagesCount > 0)
                {
                    double start = 1;
                    double limit = ViewBag.PagesCount;
                    double current = ViewBag.page;

                    start = ((current - 5) > 0 ? (current - 5) : 1);
                    limit = ((current + 5) > limit ? limit : (current + 5));

                    var queryParams = ViewContext.HttpContext.Request.Query
                    .ToDictionary(q => q.Key, q => q.Value.ToString());
                    <div class="text-center d-flex justify-content-center">
                        <nav aria-label="Page navigation example">
                            <ul class="pagination">
                                <li class="page-item"><a class="page-link"
                                        href="@Url.Action("Search","Home",new{page=1})">الأولى</a></li>
                                @for (double i = start; i <= limit; i++)
                                {
                                    queryParams["page"] = i.ToString();
                                    <li class="page-item"><a class="page-link"
                                            href="@Url.Action("Search","Home",queryParams)">@i</a>
                                    </li>
                                }
                                <li class="page-item"><a class="page-link"
                                        href="@Url.Action("Search","Home",new{page=limit})">الأخيرة</a></li>
                            </ul>
                        </nav>
                    </div>
                }
            }
        </div>

    </div>
</section>
@section Scripts {

}
